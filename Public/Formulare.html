<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Generator mit JSON</title>
    <link rel="stylesheet" href="formulare.css" />
    <style>
      /* Neue Stile für den Titel */
      .page-title {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 2.5rem;
        font-weight: 300;
        color: #000000;
        text-align: center;
        margin: 20px 0;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgb(0, 0, 0);
        position: relative;
        padding-bottom: 10px;
      }
      
      /* Anpassungen für die Checkboxen */
      .checkbox-group {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        justify-content: center;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #000000;
      }
      
      .checkbox-group label {
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
        cursor: pointer;
      }
      
      .checkbox-group input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      /* Neue Stile für die obere Steuerleiste */
      .control-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 10px;
        background-color: #f5f5f5;
        border-radius: 5px;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .semester-controls {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .semester-controls label {
        white-space: nowrap;
      }

      .example-buttons {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .saved-data-controls {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-top: 8px;
      }

      .select-with-input {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .saved-section {
        margin-top: 12px;
        border-top: 1px solid #eee;
        padding-top: 12px;
      }
    </style>
  </head>
  <body id="body-root">
    <div class="control-bar">
      <div class="user-info">
        <span>Angemeldet als: <strong id="currentUser"></strong></span>
        <button onclick="logout()" style="background-color: #f44336; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;">
          Abmelden
        </button>
      </div>

      <script>
        // Prüfe ob Benutzer angemeldet ist
        fetch('/check-auth')
          .then(response => response.json())
          .then(data => {
            if (!data.authenticated) {
              window.location.href = '/login.html';
            } else {
              document.getElementById('currentUser').textContent = data.user.role;
            }
          })
          .catch(error => {
            console.error('Auth check failed:', error);
            window.location.href = '/login.html';
          });
      </script>
      <script>
        document.getElementById('currentUser').textContent = '<%= session.user.role %>';
        function logout() {
          fetch('/logout')
            .then(() => window.location.href = '/login.html');
        }
      </script>
      <img
        alt="HTWK Logo"
        src="https://upload.wikimedia.org/wikipedia/de/1/16/HTWK-Logo.svg"
        style="height: 50px"
      />
      <button
        onclick="window.location.href='pdf-manager.html'"
        style="
          background-color: #000000;
          color: white;
          padding: 8px 16px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        "
      >
        PDF Manager
      </button>
    </div>

    <div class="container">
      <h1 class="page-title">Generator mit JSON</h1>
      
      <!-- Semester Controls unter dem Titel -->
      <div class="semester-controls">
        <label for="semester-art"> Semester: </label>
        <select id="semester-art">
          <option disabled="" selected="" value="">-- bitte wählen --</option>
          <option value="Wintersemester">Wintersemester</option>
          <option value="Sommersemester">Sommersemester</option>
        </select>
        <label for="semester-jahr"> Jahr(e): </label>
        <input
          id="semester-jahr"
          style="width: 80px"
          type="text"
          value="2025/26"
        />
        <label for="planungswochen">
          Planungswochen:
        </label>
        <input
          id="planungswochen"
          style="width: 80px"
          type="text"
          value="42–58"
        />
      </div>

      <div class="input-section">
        <h2>JSON Eingabe</h2>
        <p>Geben Sie Ihre Daten im JSON Format ein:</p>
        
        <!-- Beispiel-Buttons mit Wechsel-Button als erstes -->
        <div class="example-buttons">
          <button
            id="switch-template-btn"
            onclick="switchTemplate()"
            style="
              background: #007bff;
              color: white;
              padding: 10px 15px;
              border: none;
              border-radius: 5px;
              cursor: pointer;
            "
          >
            Wechsel zu Dozentenblatt
          </button>
          <button
            id="example-btn"
            style="background-color: #6c757d;"
          >
            Beispiel Zuarbeitsblatt
          </button>
          <button
            id="example-dozentenblatt-btn"
            style="background-color: #6c757d;"
          >
            Beispiel Dozentenblatt
          </button>
        </div>

        <textarea id="rdf-input" placeholder='Beispiel:
{
  "modul": {
    "fakultaet": "FIM",
    "studiengang": "BIB",
    "fs": "3",
    "gruppen": "13 BIB 1 - 5",
    "modulnr": "1300",
    "modulname": "BAUKO I",
    "lehrveranstaltung": "Einführung in die Bibliothekswissenschaft",
    "swsVorlesung": "2",
    "swsSeminar": "1",
    "swsPraktikum": "2",
    "raumV": "Hörsaal 123",
    "raumS": "Seminarraum 45",
    "raumP": "Labor 67",
    "technikV": "Beamer, PC",
    "technikS": "Whiteboard",
    "technikP": "Spezialausrüstung",
    "planungshinweise": "Gleichmäßige Verteilung auf gerade/ungerade Wochen, Vorlesung zwingend vor Seminar",
    "kwHinweise": "KW42, KW43, KW44, KW45, KW46, KW47, KW48, KW49, KW50, KW51, KW52, KW01, KW02, KW03, KW04, KW05, KW06",
    "name": "Prof. Dr. Müller",
    "unterschrift": "Fadi Mkhalale",
    "rueckgabedatum": "15.05.2025",
    "profUnterschrift": "Prof. Dr. Mustermann",
    "dekanUnterschrift": "Prof. Dr. Schmidt",
    "datumUnterschrift": "15.05.2025",
    "lesende": {
      "titel": "Prof. Dr.",
      "name": "Schmidt",
      "gruppen": "1-5",
      "erlaeuterung": "Gemeinsame Vorlesung für alle Gruppen, montags 09:15-10:45 Uhr"
    },
    "seminarleiter": [
      {
        "titel": "Dr.",
        "name": "Meier",
        "gruppen": "1-3",
        "erlaeuterung": "Seminar in 2 Gruppen, Blockveranstaltung gerader Wochen, Dienstag 13:30-17:00 Uhr"
      },
      {
        "titel": "M.Sc.",
        "name": "Schulze",
        "gruppen": "4-5",
        "erlaeuterung": "Seminar in 2 Gruppen, Blockveranstaltung ungerader Wochen, Mittwoch 13:30-17:00 Uhr"
      }
    ],
    "praktikumsleiter": {
      "titel": "",
      "name": "Wagner",
      "gruppen": "1-5",
      "erlaeuterung": "Praktikum in Einzelgruppen, wöchentlich wechselnd: Gruppe 1+2 (KW42,44,...), Gruppe 3+4 (KW43,45,...), Gruppe 5 (flexibel)"
    }
  }
}'></textarea>

        <div class="saved-section">
          <h3 style="margin: 6px 0">Gespeicherte JSON-Daten laden</h3>

          <label for="saved-dozenten" style="display: block; margin-top: 6px;">
            Daten (.json)
          </label>
          
          <div class="select-with-input">
            <select id="saved-dozenten">
              <option value="">-- keine ausgewählt --</option>
            </select>
            
            <input type="text" id="dozenten-input" placeholder="ID eingeben">
            
            <div class="saved-data-controls">
              <button id="load-saved-btn" type="button">
                Auswahl in Eingabe übernehmen
              </button>
              <button id="refresh-saved-btn" type="button" class="secondary">
                Liste neu laden
              </button>
            </div>
          </div>
        </div>

        <button id="parse-btn">Formular aus Eingabe füllen</button>
        <button id="generate-pdf">PDF generieren</button>
        <button id="reset-form">Eingabe zurücksetzen</button>
      </div>
      
      <div class="output-section">
        <h2>Vorschau</h2>
        <!-- Checkboxen für Studienamt, Dekan, Studiendekan -->
        <div class="checkbox-group" id="approval-area">
          <label>
            <input type="checkbox" id="checkbox-studienamt">
            Studienamt
          </label>
          <label>
            <input type="checkbox" id="checkbox-dekan">
            Dekan
          </label>
          <label>
            <input type="checkbox" id="checkbox-studiendekan">
            Studiendekan
          </label>

          <!-- Neuer Button zum Speichern der Auswahl -->
          <button id="save-approval-btn" type="button" style="margin-left:12px; padding:6px 10px;">Speichern</button>
        </div>
        
        <div id="approval-status" style="margin-top:8px;font-size:13px;color:#374151"></div>

        <div class="form-container zuarbeitsblatt" id="form-container"></div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="formulare.js" defer></script>
  </body>
</html>